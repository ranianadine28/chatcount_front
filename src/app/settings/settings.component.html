<div class="document-page">
  <img src="assets/mapping.jpg" alt="Logo" class="rounded-circle" height="150" width="150" style="margin-left: 35%; margin-bottom: 20px;">
  <h1 class="title" style="margin-left: 30%;">Paramétrages  </h1>
  <div class="add-fec-section" >
    <h3>Mapper automatiquement via le mapping ChatCount</h3>
    <div class="add-fec-options">
      <div class="add-fec-option">
        <button class="add-fec-button" [style.background-color]="fecSettingsButtonColor" (click)="toggleFECSettings()"> <i class="fa fa-tag"></i> Paramétrage du Traitement des FEC </button>
      </div>
      <div class="add-fec-option">
        <button class="add-fec-button" [style.background-color]="keywordsButtonColor" (click)="toggleKeywords()"> <i class="fa fa-code"></i> Paramétrage des mots clés </button>
      </div>
      <div class="add-fec-option">
        <button class="add-fec-button" [style.background-color]="patternsButtonColor" (click)="togglePatterns()"> <i class="fa fa-check"></i> Paramétrage des patterns </button>
      </div>
    </div>
  </div>
  <div class="fec-list-section">
    <div class="table-container" *ngIf="showKeywords">
      <div class="add-column">
        <input type="text" [(ngModel)]="newColumnName" placeholder="Nom de la nouvelle colonne">
        <button (click)="addColumn()">Ajouter colonne</button>
      </div>
      
      <table class="csv-table">
        <thead>
          <tr>
            <th *ngFor="let column of csvData?.titre.split(';')">{{ column }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of csvData?.contenu; let i = index">
            <ng-container *ngFor="let cell of row.split(';'); let j = index">
              <td>
                <ng-container *ngIf="!isEditing[i]?.[j]; else editMode">
                  <span (click)="toggleEdit(i, j)" class="edit-icon"><i class="fas fa-edit"></i></span>
                  <div (click)="deleteCsvData(i, j)" class="delete-icon">
                    <i class="fas fa-trash"></i>
                  </div>
                  <span>{{ cell }}</span>
                </ng-container>
                <ng-template #editMode>
                  <input type="text" [(ngModel)]="csvData.contenu[i][j]" (blur)="updateCellValue(i, j, $event)" />
                </ng-template>
              </td>
            </ng-container>
           
          </tr>
          <tr>
            <ng-container *ngFor="let column of csvData?.titre.split(';'); let j = index">
              <td>
                <input type="text" [(ngModel)]="newRow[j]" />
              </td>
            </ng-container>
            <td>
              <button (click)="insertRow()" class="add_buttom">Insérer</button>
            </td>
          </tr>
        </tbody>
      </table>
      
      
    </div>
    <div class="table-container" *ngIf="showPatterns">
     
      <table class="csv-table">
        <thead>
          <tr>
            <th *ngFor="let column of patternsData?.titre.split(';')">{{ column }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of patternsData?.contenu; let i = index">
            <ng-container *ngFor="let cell of row.split(';'); let j = index">
              <td>
                <ng-container *ngIf="!isEditing[i]?.[j]; else editMode">
                  <span (click)="toggleEdit(i, j)" class="edit-icon"><i class="fas fa-edit"></i></span>
                  <div (click)="deletePatternData(i, j)" class="delete-icon">
                    <i class="fas fa-trash"></i>
                  </div>
                  <span>{{ cell }}</span>
                </ng-container>
                <ng-template #editMode>
                  <input type="text" [(ngModel)]="patternsData.contenu[i][j]" (blur)="updatePatternValue(i, j, $event)" />
                </ng-template>
              </td>
            </ng-container>
           
          </tr>
          <tr>
            <ng-container *ngFor="let column of patternsData?.titre.split(';'); let j = index">
              <td>
                <input type="text" [(ngModel)]="newRow[j]" />
              </td>
            </ng-container>
            <td>
              <button (click)="insertRowPaatern()" class="add_buttom">Insérer</button>
            </td>
          </tr>
        </tbody>
      </table>
      
      
    </div>
  <div  *ngIf="showFECSettings"> <div class="card-container" >
    <div class="labels-row">
      <h2 (click)="toggleLabels1()">Racine 1</h2>
      <h2 (click)="toggleLabels2()">Racine 2</h2>
      <h2 (click)="toggleLabels3()">Racine 3</h2>
      <h2 (click)="toggleLabels4()">Racine 4</h2>
      <h2 (click)="toggleLabels5()">Racine 5</h2>
    </div>
    <form (ngSubmit)="searchLabels()">
      <input class="recherche" type="text" [(ngModel)]="searchRootId" name="searchRootId" placeholder="Racine">
      <input class="recherche" type="text" [(ngModel)]="searchLabel" name="searchLabel" placeholder="Libellé">
      <button type="submit">Rechercher</button>
    </form>
    
    <div class=" h-[73vh] flex-grow overflow-y-scroll">

      <div class="mb-4" *ngIf="showLabels1">

  
          

        <div class="flex flex-col items-center justify-center space-y-4 ">

            <ul class="labels-list" >
<li *ngFor="let label of labels">
  <div>
    <span>{{ label.rootId }} - </span>
    
    <input style="width: 800px;" type="text" [(ngModel)]="label.label" (blur)="updateLabel(label._id, label.label)">
    <button  class="delete-button" (click)="onDeleteLabel1(label._id)">
      <i class="fa fa-trash-alt margin-right" style="cursor: pointer;"></i>
    </button>
  </div>
</li></ul>
            </div>
          </div>
          <div class=" h-[73vh] flex-grow overflow-y-scroll">

            <div class="mb-4"*ngIf="showLabels2">
      
        
                
      
              <div class="flex flex-col items-center justify-center space-y-4 ">
      

<ul class="labels-list" >
  <li *ngFor="let label of (showAllLabels2 ? labels2 : labels2 | slice:0:thresholdToShow)"> <div>
    <span>{{ label.rootId }} - </span>
    
    <input style="width: 800px;" type="text" [(ngModel)]="label.label" (blur)="updateLabel2(label._id, label.label)">
    <button  class="delete-button" (click)="onDeleteLabel2(label._id)">
      <i class="fa fa-trash-alt margin-right" style="cursor: pointer;" aria-hidden="true"></i>
    </button>
  </div></li>
  <li *ngIf="labels2.length > thresholdToShow">
    <button class="voir" (click)="toggleShowAllLabels2()">
      {{ showAllLabels2 ? 'Réduire' : 'Voir plus' }}
    </button>
  </li>
</ul>

</div>
</div>
<div class=" h-[73vh] flex-grow overflow-y-scroll">

  <div class="mb-4"  *ngIf="showLabels3">


      

    <div class="flex flex-col items-center justify-center space-y-4 ">

<ul class="labels-list">
  <li *ngFor="let label of (showAllLabels3 ? labels3 : labels3 | slice:0:thresholdToShow)"> <div>
    <span>{{ label.rootId }} - </span>
    
    <input style="width: 800px;" type="text" [(ngModel)]="label.label" (blur)="updateLabel3(label._id, label.label)">
    <button  class="delete-button" (click)="onDeleteLabel3(label._id)">
      <i class="fa fa-trash-alt margin-right" style="cursor: pointer;" aria-hidden="true"></i>
    </button>
  </div></li>
  <li *ngIf="labels3.length > thresholdToShow">
    <button class="voir" (click)="toggleShowAllLabels3()">
      {{ showAllLabels3 ? 'Réduire' : 'Voir plus' }}
    </button>
  </li>
</ul>
</div>
</div>
<div class=" h-[73vh] flex-grow overflow-y-scroll">

  <div class="mb-4"  *ngIf="showLabels4">


      

    <div class="flex flex-col items-center justify-center space-y-4 ">

<ul class="labels-list">
  <li *ngFor="let label of (showAllLabels4 ? labels4 : labels4 | slice:0:thresholdToShow)"> <div>
    <span>{{ label.rootId }} - </span>
    
    <input style="width: 800px;" type="text" [(ngModel)]="label.label" (blur)="updateLabel4(label._id, label.label)">
    <button  class="delete-button" (click)="onDeleteLabel4(label._id)">
      <i class="fa fa-trash-alt margin-right" style="cursor: pointer;" aria-hidden="true"></i>
    </button>
  </div></li>
  
  <li *ngIf="labels4.length > thresholdToShow">
    <button class="voir"  (click)="toggleShowAllLabels4()">
      {{ showAllLabels4 ? 'Réduire' : 'Voir plus' }}
    </button>
  </li>
</ul>
</div>
</div>
<div class=" h-[73vh] flex-grow overflow-y-scroll">

  <div class="mb-4" *ngIf="showLabels5">


      

    <div class="flex flex-col items-center justify-center space-y-4 ">

<ul class="labels-list">
  <li *ngFor="let label of (showAllLabels5 ? labels5 : labels5 | slice:0:thresholdToShow)"> <div>
    <span>{{ label.rootId }} - </span>
    
    <input style="width: 800px;" type="text" [(ngModel)]="label.label" (blur)="updateLabel5(label._id, label.label)">
    <button  class="delete-button" (click)="onDeleteLabel5(label._id)">
      <i class="fa fa-trash-alt margin-right" style="cursor: pointer;"aria-hidden="true"></i>
    </button>
  </div></li>
  <li *ngIf="labels5.length > thresholdToShow">
    <button class="voir"  (click)="toggleShowAllLabels5()">
      {{ showAllLabels5 ? 'Réduire' : 'Voir plus' }}
    </button>
  </li>
</ul>
</div>
</div>
<h2>Ajouter un nouveau libellé</h2>
<div>
  <label for="newLabelRootId">Identifiant racine :</label>
  <input type="text" id="newLabelRootId" [(ngModel)]="newLabelRootId">
</div>
<div>
  <label for="newLabelName">Nom du libellé :</label>
  <input type="text" id="newLabelName" [(ngModel)]="newLabelName">
</div>
<button (click)="addNewLabel()" class="btn btn-outline-primary">Ajouter</button>
</div>

  
</div>
 
